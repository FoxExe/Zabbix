# Zabbix
Zabbix mods, addons, plugins, scripts and other stuff

Меркурий 2хх - Это электросчетчик одноименной компании. Широко используется Российскими Энерго Компаниями.
Имеет на борту RS485 с собственным протоколом общения. В 230 заявлена поддержка Modbus, но активируется только вручную.
\* Числа в ответах гдето передаюся как Hex, гдето как Dec. Гдето вообще всё наизнанку (Big Endian / Little Endian по ходу)

# Формат данных
### Меркурий-200:
Запрос:
* 3 байт - Последние 6 цифр серийного номера (Байты инвертированы) (unsigned char[3])
* 1 байт - Комманда
* х байт - Ответ (В запросе не используется)
* 2 байт - Modbus CRC (CRC-16, 0xA002) (unsigned char[2])
Команды:
* 0x61 / 0x62 = Case open (Вскрытие корпуса) Ответ: 7 байт Дата/время (Обычно 0xFF - тоесть "Не вскрывался")
* 0x2B / 0x2C = Power OFf/On date/time
* 0x29 = Напряжение на внутренней батарее (Ответ: {0x02, 0x90} = тоесть 2.9 вольт)
* 0x28 = Версия прошивки. Ответ: 08 03 00 18 07 12 (FW v8.3 от 18.07.2012)
* 0x66 = Дата сборки (Ответ: 07 03 14 13, тоесть: 07.13.2014)
* 0x63 = Текущие значения U, I, F (Ответ: 22 77 00 18 00 00, 3 числа по 2 байта, тоесть: 227.7 вольт, 0.18 Ампер, частота 0 (Не поддерживается))


### Меркурий-230:
* 1 байт - Последние 2 числа серийного номера (unsigned char)
* х байт - Команда или Ответ
* 2 байт - Modbus CRC (unsigned char[2])
Формат: Запрос авторизации, ответ, кзапрос данных, ответ, [...], запрос на деавторизацию, ответ. (Между командами требуется пауза в 3 символа, или около 30мс времени)
```c++
uint8_t cmd_auth[11] = { 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x77, 0x81 };
uint8_t cmd_exit[4] = { 0x00, 0x02, 0x80, 0x71 };
```
Ответы в формате 0x00 0x10 0x20. Читать как 0x2010 (0x2010=8208, uint_16t)
* 08 11 00 = Мощьность (00...0B)
* 08 11 11 = Напряжение на фазе (0x11 = Фаза 1, 0x12 = Фаза 2, 0x13 = Фаза 3)
* 08 11 21 = Ток на фазе (0x21 = Фаза 1, 0x22 = Фаза 2, 0x23 = Фаза 3)
* 08 11 30 = Коэфицент мощности (0x00 = Общийб 0x31 = Фаза 1, 0x32 = Фаза 2, 0x33 = фаза 3)
* 08 11 40 = Частота (Гц, по всем фазам)
* 08 11 51 = Угол между фазами (0x51: 1 и 2, 0x52: 1 и 3, 0x53: 2 и 3)

* 04 00 = Текущая дата/время (Возвращяет: 20 35 10 03 25 01 17 01. Тоесть: с м ч ? д м г ? (10ч 35м 20с, 25 янв 2017 и неизвестные разделители
Ответы в формате: 10 20 30 40 FF FF FF FF 50 60 70 80 FF FF FF FF (4 числа по 4 байта / int[4], "A+ A- R+ R-")
\* 0x10203040 читать как 0x20104030 (Пример: "5B 07 15 CD" => "07 5B CD 15" = 0x075BCD15 = 123456789)
* 05 00 00 = Насчитанно кВт\*ч (Всего)
* 05 00 01 = кВт\*ч по тарифам (0x01...0x04)
Ответы в формате: A1 A2 A3 A4 B1 B2 B3 B4 C1 C2 C3 C4 (3 числа по 4 байт / int[3])
* 05 60 00 = Сумма А+, по фазам (Фаза 1, Фаза 2, Фаза 3)
* 05 60 01 = кВт\*ч по тарифам (0x01...0x04)
